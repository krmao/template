apply plugin: 'com.android.library'
apply from: "$flutterRoot/packages/flutter_tools/gradle/flutter.gradle"

def bundleName = 'flutter-bundle'

android {
    compileSdkVersion 27

    lintOptions {
        disable 'InvalidPackage'
    }

    defaultConfig {
        minSdkVersion 16
        targetSdkVersion 27
        versionCode project.flutterVersionCode.toInteger()
        versionName project.flutterVersionName
    }

    android.libraryVariants.all { variant ->
        variant.outputs.all {
            outputFileName = "$bundleName-${defaultConfig.versionName}-${variant.getBuildType().getName()}.aar"
        }
    }
}


afterEvaluate {
    assembleDebug.doLast { copyBundle.execute() }
    assembleRelease.doLast { copyBundle.execute() }
}

def srcDir="../../build/$bundleName/outputs/aar"
def targetDir="../../../android/arsenal/libraries/thirdparty/thirdparty-aars"
task copyBundle(type: Copy) {
    from srcDir
    into targetDir
    include('**/*.aar')
}

flutter {
    source '../..'
}
