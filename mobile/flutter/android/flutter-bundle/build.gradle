apply plugin: 'com.android.library'
apply from: "$flutterRoot/packages/flutter_tools/gradle/flutter.gradle"

android {
    compileSdkVersion 27

    lintOptions {
        disable 'InvalidPackage'
    }

    defaultConfig {
        minSdkVersion 16
        targetSdkVersion 27
        versionCode flutterVersionCode.toInteger()
        versionName flutterVersionName
        testInstrumentationRunner "android.support.test.runner.AndroidJUnitRunner"
    }
    android.libraryVariants.all { variant ->
        variant.outputs.all {
            outputFileName = "${project.name}-${defaultConfig.versionName}-${variant.getBuildType().getName()}.aar"
        }
    }

    sourceSets {
        main {
            java {
                srcDirs '../app/src/main/java/io'
            }
        }
    }
}

flutter {
    source '../..'
}

afterEvaluate {
    assembleDebug.doLast { copyBundle.execute() }
    assembleRelease.doLast { copyBundle.execute() }
}

def srcDir = "../../build/${project.name}/outputs/aar"
def targetDir = "../../../android/app/libraries/repo/aars"
task copyBundle(type: Copy) {
    from srcDir
    into targetDir
    include('**/*.aar')
}

dependencies {
    testImplementation 'junit:junit:4.12'
    androidTestImplementation 'com.android.support.test:runner:1.0.2'
    androidTestImplementation 'com.android.support.test.espresso:espresso-core:3.0.2'
}
