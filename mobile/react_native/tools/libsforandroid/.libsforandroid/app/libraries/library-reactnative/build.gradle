apply plugin: "com.android.library"
apply plugin: "kotlin-android"
apply plugin: 'kotlin-android-extensions'
apply plugin: 'com.kezong.fat-aar'

android {
    compileSdkVersion = rootProject.ext.compileSdkVersion
    buildToolsVersion = rootProject.ext.buildToolsVersion
    defaultConfig {
        minSdkVersion rootProject.ext.minSdkVersion
        targetSdkVersion rootProject.ext.targetSdkVersion
    }

    buildTypes {
        release {
            minifyEnabled false
        }
    }

    flavorDimensions "default"
}

// the default value is false
// invalid for local aar dependency
configurations.embed.transitive = false

dependencies {
    embed project(path: ':react-native-gesture-handler', configuration: 'default')
    embed project(path: ':react-native-safe-area-context', configuration: 'default')

    api "androidx.transition:transition:1.1.0"
    embed project(path: ':react-native-reanimated', configuration: 'default')
    embed project(path: ':react-native-vector-icons', configuration: 'default')

    // react-native/ReactAndroid/gradle.properties
    def FRESCO_VERSION = "2.0.0"
    def OKHTTP_VERSION = "3.12.1"
    def SO_LOADER_VERSION = "0.8.0"

    api "androidx.appcompat:appcompat:1.0.2"

    api("javax.inject:javax.inject:1")
    api("com.google.code.findbugs:jsr305:3.0.2")

    api("com.squareup.okhttp3:okhttp:${OKHTTP_VERSION}")
    api("com.squareup.okhttp3:okhttp-urlconnection:${OKHTTP_VERSION}")
    api("com.squareup.okio:okio:1.15.0")

    api("com.facebook.infer.annotation:infer-annotation:0.11.2")
    api("com.facebook.yoga:proguard-annotations:1.14.1")
    api("com.facebook.fresco:fresco:${FRESCO_VERSION}")
    api("com.facebook.fresco:imagepipeline-okhttp3:${FRESCO_VERSION}")
    api("com.facebook.soloader:soloader:${SO_LOADER_VERSION}")
    api("com.facebook.fbjni:fbjni-java-only:0.0.3")
    embed("com.facebook.react:react-native:${rootProject.ext.reactNativeVersion}")
}

apply plugin: "maven"

group = "com.smart.library"
def artifactID = "libs-reactnative"
version = "${rootProject.ext.reactNativeVersion}.1-SNAPSHOT"

uploadArchives {
    repositories {

        // upload to flatDir
        // flatDir { dirs "file://$rootProject.projectDir/../repo" }

        // upload to maven
        mavenDeployer {
            snapshotRepository(url: "file://$rootProject.projectDir/../repo") {
                authentication(userName: "", password: "")
            }
            repository(url: "file://$rootProject.projectDir/../repo") {
                authentication(userName: "", password: "")
            }
            pom.packaging = "aar"
            pom.groupId = project.group
            pom.artifactId = artifactID
            pom.version = project.version
        }
    }
}

apply from: "$rootProject.projectDir/gradle/upload_to_jcenter.gradle"
